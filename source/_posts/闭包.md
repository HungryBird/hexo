---
title: 闭包
date: 2019-12-27 23:50:57
tags:
- 闭包
categories:
- javascript
---
<!--excerpt-->
闭包，MDN的定义是“引用自由变量的函数”。

自由变量：不是函数的形参，不是函数局部变量的变量。

所以在《JavaScript权威指南》中就讲到：从技术的角度讲，所有的JavaScript函数都是闭包。
<!--more-->
>闭包面试题必考
````javascript
var data = [];

for (var i = 0; i < 3; i++) {
  data[i] = function () {
    console.log(i);
  };
}

data[0]();
data[1]();
data[2]();
````
一般面试官会这样问：

1.打印的结果是什么。

答：都输出

2.怎样打印出0，1，2？

答：用let声明i或者改成闭包

````javascript
var data = [];

for (var i = 0; i < 3; i++) {
  data[i] = (function (i) {
        return function(){
            console.log(i);
        }
  })(i);
}

data[0]();
data[1]();
data[2]();
````

>为什么闭包可以得到期望的结果？

原理解析如下：

执行data[0]的时候

1. 进入全局代码，创建全局执行上下文，全局执行上下文压入执行上下文栈。
2. 进入匿名函数，创建匿名函数执行上下文，匿名函数执行上下文被压入执行上下文栈。
3. 匿名函数执行后弹出执行上下文栈。
4. 进入data[0]，创建data[0]执行上下文，data[0]执行上下文被压入执行上下文栈。
5. 执行data[0]函数时，data[0]函数通过作用域链找到匿名函数作用域链，并在匿名函数作用域的AO对象中找到key为i的值。

参考：<a href="https://github.com/mqyqingfeng/Blog/issues/9">JavaScript深入之闭包</a>